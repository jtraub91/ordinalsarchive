{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordinals Archive</title>
    <link rel="icon" href="{% static 'images/favicon.png' %}">
    <link href="{% static 'dist/tailwind.css' %}" rel="stylesheet">
    <link href="{% static 'dist/fontawesome-free/css/all.min.css' %}" rel="stylesheet">
    <link href="{% static 'dist/quill/quill.snow.css' %}" rel="stylesheet">
    <link href="{% static 'css/main.css' %}" rel="stylesheet">

    <script>
      (function() {
        const userPref = localStorage.getItem('theme');
        const systemPref = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (userPref === 'dark' || (!userPref && systemPref)) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      })();
    </script>
  </head>
  <body class="bg-[#fff3cd] dark:bg-black dark:text-white transition-colors">
    <canvas id="bg-canvas" class="hidden dark:block fixed top-0 left-0 -z-10 pointer-events-none"></canvas>
    <form action="/" method="get" hx-get="/" hx-target="#content" hx-push-url="true" hx-trigger="change delay:300ms, input delay:300ms">
      <div class="flex h-16">
        <div>
          <a href="/">
            <img class="inline-block md:hidden h-full"
              src="{% static 'images/logo.svg' %}" alt="Ordinals Archive Logo"/>
            <h1 class="text-6xl font-anton hidden md:block">Archive</h1>
          </a>
        </div>
        <div class="grow ml-2 h-full relative">
          <div class="text-xl h-full">
            <input 
              value="{{ request.GET.q|default_if_none:'' }}"
              name="q"
              id="q"
              class="w-full h-full p-2 border-b-2 text-lg placeholder:text-sm md:placeholder:text-lg tracking-tighter md:tracking-normal md:text-lg lg:text-2xl border-black dark:border-pink-500 placeholder:text-center placeholder:text-gray-700 dark:placeholder:text-gray-300 dark:placeholder:text-center"
              type="text" placeholder="search the Bitcoin blockchain"/>
          </div>
          <div class="flex flex-row justify-between w-full absolute text-sm md:text-lg top-full">
            <div class="cursor-pointer flex" id="filters_toggle">
              <label for="filters" class="cursor-pointer flex">
                <i class="fa-solid fa-filter text-2xl my-auto" title="filters"></i>
              </label>
            </div>
            <div id="filters" class="hidden absolute bg-white/80 dark:bg-zinc-800/80 border border-gray-300 dark:border-zinc-700 shadow-lg p-4 z-50 min-w-[220px]">
              <div class="flex justify-between items-center mb-2">
                <span class="font-semibold">Advanced Filters</span>
                <button type="button" id="filters_close" aria-label="Close filters" class="text-gray-600 dark:text-gray-300 hover:text-black dark:hover:text-white text-xl px-2">&times;</button>
              </div>
              <h3 class="font-semibold">Object Type</h3>
              <ul>
                <li>
                  <input 
                    {% if 'inscription' in query_object_types %}checked{% endif %}
                    type="checkbox"
                    name="object_type"
                    value="inscription" 
                    id="object_type_inscription">
                  <label for="object_type_inscription" class="font-normal pr-2">
                    Inscription
                  </label>
                </li>
                <li>
                  <input 
                    {% if 'coinbase' in query_object_types %}checked{% endif %}
                    type="checkbox"
                    name="object_type"
                    value="coinbase" 
                    id="object_type_coinbase">
                  <label for="object_type_coinbase">
                    Coinbase
                  </label>
                </li>
                <li>
                  <input 
                    {% if 'op_return' in query_object_types %}checked{% endif %}
                    type="checkbox"
                    name="object_type"
                    value="opreturn" 
                    id="object_type_opreturn">
                  <label for="object_type_opreturn">
                    OpReturn
                  </label>
                </li>
              </ul>
              <div id="content_types_container" hx-push-url="false" hx-trigger="load" hx-get="/content_types" hx-target="#content_types_container" hx-swap="innerHTML">
                
              </div>
              <div>
                <h3 class="font-semibold">Date Range</h3>
                <div>
                  <input type="date" name="start_date" value="{{ request.GET.start_date|default_if_none:'' }}"/>
                  <input type="date" name="end_date" value="{{ request.GET.end_date|default_if_none:'' }}"/>
                </div>
              </div>
            </div>
            <div class="flex flex-row gap-1">
              <div class="my-0.5 hidden">
                <label class="hidden" for="sort_select">
                  Sort
                </label>
                <select name="sort" title="Sort By" id="sort_select" class="border-black border-2 p-0.5 appearance-none text-center bg-white text-sm dark:bg-zinc-900 text-black dark:text-white  dark:border-zinc-700">
                  <option value="date" {% if request.GET.sort == "date" %}selected{% endif %}>timestamp</option>
                  <option value="relevance" {% if request.GET.sort == "relevance" %}selected{% endif %}>relevance</option>
                </select>
              </div>
              {% if request.GET.order == "asc" %}
              <img class="cursor-pointer transform mt-0.5 triangle-svg-filter" src="{% static 'images/triangle.png' %}" title="sort" id="order_toggle"/>
              {% else %}
              <img class="cursor-pointer transform mt-0.5 rotate-180 triangle-svg-filter" src="{% static 'images/triangle.png' %}" title="sort" id="order_toggle"/>
              {% endif %}
              <div class="hidden">
                <label for="order_select">
                  Order
                </label>
                <select name="order" id="order_select">
                  <option value="desc" {% if request.GET.order == "desc" %}selected{% endif %}>Descending</option>
                  <option value="asc" {% if request.GET.order == "asc" %}selected{% endif %}>Ascending</option>
                </select>
              </div>

              <div class="my-0.5 hidden">
                <label class="hidden" for="view_select">
                  View
                </label>
                <select name="view" title="View" id="view_select" class="border-black border-2 p-0.5 appearance-none text-center bg-white text-sm dark:bg-zinc-900 text-black dark:text-white  dark:border-zinc-700">
                  <option value="gallery" {% if request.GET.view == "gallery" %}selected{% endif %}>gallery</option>
                  <option value="list" {% if request.GET.view == "list" %}selected{% endif %}>list</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div title="Toggle dark mode" id="darkmode_toggle"
          class="cursor-pointer h-full w-16 flex justify-center">
          <i class="fa-solid fa-moon my-auto text-6xl"></i>
        </div>
      </div>
    </form>
    <div class="py-4 my-4 mx-4">
      <div class="w-full flex flex-col justify-center items-center" id="content">
        {% block content %}
        {% include "components/results.html" with results=results%}
        {% endblock %}
      </div>
    </div>
    {% block scripts %}
    <script src="{% static 'dist/htmx.min.js' %}"></script>
    <script src="{% static 'dist/quill/quill.js' %}"></script>
    <script src="{% static 'js/main.js' %}"></script>
    {% endblock %}
  </body>
</html>
